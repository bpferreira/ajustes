name: Ajustes Diário

on:
  schedule:
    - cron: "30 8 * * 1-5"  # Executa às 05:30 BRT (08:30 UTC), de segunda a sexta
  workflow_dispatch:

jobs:
  baixar-b3:
    runs-on: ubuntu-latest
    container:
      image: bpferreira/ajustes:latest  # Usa imagem Docker personalizada do Docker Hub
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Rodar baixar_b3.R com retry
        run: |
          for i in {1..10}; do
            echo "Tentativa {$i} para baixar B3..."
            Rscript R/baixar_b3.R && break
            sleep 5
          done

  baixar-anbima:
    runs-on: ubuntu-latest
    container:
      image: bpferreira/ajustes:latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Rodar baixar_anbima.R com retry
        run: |
          for i in {1..10}; do
            echo "Tentativa {$i} para baixar ANBIMA..."
            Rscript R/baixar_anbima.R && break
            sleep 5
          done
